# Step-Auto（基本設計フェーズ分解）

各ステップは「入力 → 作業 → 出力 → 品質ゲート」。不足情報が多い場合は推測で進めず、`question-bank.md` から最大5件選んで質問して停止する。

## 1. 入口整形（入力収集）

- 入力: 要件/背景/制約/既存資料/用語
- 作業: 前提・制約・用語・未確定を整理
- 出力: 前提・制約・用語集・未確定一覧
- ゲート: 未確定が多い→質問して停止

## 2. 目的・非目的（スコープ固定）

- 入力: 背景、要件
- 作業: Goals/Non-goals を最小で確定
- 出力: Goals / Non-goals / 成功条件（最小）
- ゲート: Non-goals が曖昧→差分確認

## 3. システム境界（コンテキスト図）

- 入力: 外部システム、利用者、データの出入り
- 作業: 境界内/外を明示（必要なら Mermaid）
- 出力: System Context（関係者/外部/境界）
- ゲート: 境界外の責務が混入→分離/質問

## 4. ユースケース一覧（粒度合わせ）

- 入力: 要件、ユーザー行動
- 作業: 主要ユースケースと失敗系を棚卸し
- 出力: ユースケース一覧（優先度つき）
- ゲート: 重要フローの欠落→追質問/追記

## 5. 論理アーキテクチャ（コンポーネント分割）

- 入力: 境界、ユースケース
- 作業: コンポーネント・責務・依存・データ所有を整理（必要なら Mermaid）
- 出力: コンポーネント図 + 責務/依存/データ所有
- ゲート: 循環依存/責務の空白/単一責務違反→再分割

## 6. データ設計（概念/論理）

- 入力: ユースケース、IF、既存DB（あれば）
- 作業: 主要エンティティ/関係/キー/整合性方針を定義
- 出力: エンティティ一覧 + テーブル詳細（`db.md`）
- ゲート: 重要ユースケースをデータで説明できない→不足を質問

## 7. IF設計（API/イベント/バッチ）

- 入力: 境界、ユースケース、既存IF
- 作業: IF一覧（入出力・認可・冪等・エラー）→個別詳細
- 出力: API（`api.md`）/Batch（`batch.md`）の「一覧→詳細」
- ゲート: 境界IFが網羅されない、責務と矛盾→修正/質問

## 8. フロー設計（シーケンス/状態）

- 入力: 主要ユースケース、IF、データ整合性要件
- 作業: 主要3〜5フローを文章で確定し、必要ならシーケンス図に落とす
- 出力: フロー記述 + Mermaid（`diagrams.md`）
- ゲート: 競合/再試行/整合性（最終一貫性等）の扱いが不明→質問

## 9. NFR（性能・可用性・運用・セキュリティ）

- 入力: 期待値、制約、運用体制
- 作業: 守るべきもの（SLO等）と測り方（監視）を最小で定義
- 出力: `nfr.md` の章
- ゲート: “守るべきもの” と “測り方” がない→質問

## 10. 移行・互換（既存がある場合）

- 入力: 現状仕様、互換要求、データ量
- 作業: 段階導入/後方互換/データ移行方針/ロールバック方針を定義
- 出力: 移行手順（段階）/後方互換/データ移行方針
- ゲート: ロールバック不能・段階導入不可が未整理→リスク化/質問

## 11. リスク・未決事項・意思決定ログ

- 入力: ここまでの未確定/選択肢
- 作業: リスク、未決、意思決定（理由）を記録
- 出力: Risks / Open Questions / Decisions（理由付き）
- ゲート: “次に誰が何を決めるか” が不明→担当/期限を追記

## 12. 成果物パッケージング（1枚Markdown化）

- 入力: 1〜11の成果
- 作業: `template-base.md` に統合し、一覧→詳細の対応、見出し階層、図配置を整える
- 出力: 基本設計書（1枚Markdown）+ 図（Mermaid）
- ゲート: 詳細設計へ渡す「未決/前提」が明示されていない→追記

