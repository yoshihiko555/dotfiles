# 解析レポート: SKILL.md (decision-log)

## 基本情報

| 項目 | 内容 |
|------|------|
| 種別 | Skill |
| 名前 | decision-log |
| ファイルパス | `/Users/yoshihiko/ghq/github.com/yoshihiko555/dotfiles/shared/skills/common/decision-log/SKILL.md` |
| 概要 | コミット直前にADR（Architecture Decision Record）と DECISIONS.md を一貫した形式で作成・更新する運用スキル。会話履歴とコミット差分を踏まえて意思決定内容を要約・記録する。 |

## 目的・ユースケース

- 解決する問題: 実装時の意思決定が記録されず、後から「なぜこうなったか」を追えなくなる問題
- 使用場面: コミット直前のタイミングで、方針決定の議論とコード差分をもとにADRを作成する

## 内容の要約

### 基本ルール
- 既存ADRがある場合は最新ADRの構成・見出し・語調に合わせる
- 既存ADRがない場合はプロジェクト内テンプレートを参照する
- 不明点は最小限の確認質問に留め、事実の捏造はしない

### 変数定義
- 9つの変数をテーブル形式で定義（必須/自動/任意の区別、取得方法を明記）

### 実行フロー
- 7ステップの手順（差分整理 → 既存ADR確認 → 連番決定 → ADR作成 → DECISIONS.md追記 → 見直し → コミット）

### プロンプトテンプレート
- 変数展開に特化した簡潔なテンプレート（手順・制約は他セクション参照）

### 出力フォーマット
- DECISIONS.md の追記フォーマット（テーブル形式）
- コミットメッセージの例

### 検証
- 5項目のチェックリストで成功条件を明示

## 処理フロー

1. コミット対象の差分と方針決定の議論を整理する
2. `{ADR_DIR}` 内の最新ADRを確認し、構成・見出し・語調を合わせる
3. `{DECISIONS_PATH}` を確認し、次の連番 `{NEXT_ID}` を決める
4. 新規ADRを作成: `{ADR_DIR}/{ADR_PREFIX}-{DATE_NOSEP}-{NEXT_ID}.md`
5. `DECISIONS.md` の ADR 一覧に1行追記（既存形式に合わせる）
6. 内容を見直し、必要なら修正
7. Git で実装差分 + ADRファイル + DECISIONS.md をまとめてコミット

### 入出力仕様

| 項目 | 内容 |
|------|------|
| 入力 | コミット対象の差分、直前の会話履歴（方針決定の議論）、プロジェクト変数（ADR_DIR等） |
| 出力 | 新規ADRファイル（Markdown）、DECISIONS.md への追記行、コミット |

### 使用ツール一覧

- 明示的なツール指定なし（Read, Write, Edit, Bash(git) が暗黙的に必要）

## 構造評価

| 推奨セクション | 状態 | 備考 |
|--------------|------|------|
| Instructions | ✅ 充足 | 「実行フロー」と「作成プロンプト」で手順が明確 |
| Inputs | ✅ 充足 | 変数テーブルで必須/任意・取得方法を明記 |
| Constraints | ⚠️ 部分的 | 「基本ルール」に制約が含まれるが、独立したセクションとしての整理がない |
| Output Format | ✅ 充足 | DECISIONS.md追記フォーマットとコミットメッセージ例を明示 |
| Examples | ⚠️ 部分的 | プロンプトテンプレートとフォーマット例はあるが、実際の完成ADRの具体例がない |
| Verification | ✅ 充足 | 5項目のチェックリストで成功条件を明示 |

## ルーブリック評価

| 軸 | 優先度 | 評価 | 理由 |
|----|--------|------|------|
| 構造の完全性 | 高 | Good | 6セクション中4つが充足、2つが部分的。主要な構造は網羅 |
| 成功基準の明確性 | 高 | Good | 検証チェックリストで5つの具体的な成功条件を明示 |
| トークン効率 | 高 | Good | プロンプトテンプレートは変数展開のみに簡素化、セクション間の重複なし |
| 指示の具体性 | 中 | Good | 各ステップが具体的で、条件分岐（既存ADRあり/なし）も明確。変数テーブルで曖昧さを排除 |
| 使用例の充実 | 中 | Needs Improvement | フォーマット例とプロンプト例はあるが、完成形のADRサンプルがない |
| 一貫性 | 低 | Good | dotfiles リポジトリ内の他スキルと命名・構造が概ね一致。日本語で統一 |

## チューニング推奨事項

### 1. 完成形のADR例の追加
- **優先度:** 中
- **対象:** Examples セクション（新規）
- **現状:** フォーマット断片とコミットメッセージ例のみ
- **提案:** 小規模な完成ADRのサンプル（10-15行程度）を1件追加。実行フローの各ステップがどう反映されるかを示す

### 2. エッジケースの明記
- **優先度:** 低
- **対象:** Constraints / フロー内の条件分岐
- **現状:** 「既存ADRがない場合」のフォールバックは記載あるが、テンプレートも見つからない場合の挙動が「配置先を確認する」のみ
- **提案:** テンプレート不在時の具体的なフォールバック手順（最小ADR構成の提示、またはユーザーへの確認質問の内容）を明記

### 3. 使用ツールの明示
- **優先度:** 低
- **対象:** ファイル全体
- **現状:** 暗黙的に Read, Write, Edit, Bash(git) が必要だが明記なし
- **提案:** frontmatter に `allowed-tools` を追加するか、フロー内で各ステップのツール使用を明記
