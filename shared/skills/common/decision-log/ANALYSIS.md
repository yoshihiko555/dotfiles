# 解析レポート: SKILL.md (decision-log)

## 基本情報

| 項目 | 内容 |
|------|------|
| 種別 | Skill |
| 名前 | decision-log |
| ファイルパス | `/Users/yoshihiko/ghq/github.com/yoshihiko555/dotfiles/shared/skills/common/decision-log/SKILL.md` |
| 概要 | コミット直前にADR（Architecture Decision Record）と DECISIONS.md を一貫した形式で作成・更新する運用スキル。会話履歴とコミット差分を踏まえて意思決定内容を要約・記録する。 |

## 目的・ユースケース

- 解決する問題: 実装時の意思決定が記録されず、後から「なぜこうなったか」を追えなくなる問題
- 使用場面: コミット直前のタイミングで、方針決定の議論とコード差分をもとにADRを作成する

## 内容の要約

### 基本ルール
- 既存ADRがある場合は最新ADRの構成・見出し・語調に合わせる
- 既存ADRがない場合はプロジェクト内テンプレートを参照する
- 不明点は最小限の確認質問に留め、事実の捏造はしない

### 変数定義
- 9つの変数をテーブル形式で定義（必須/自動/任意の区別、取得方法を明記）

### 実行フロー
- 7ステップの手順（差分整理 → 既存ADR確認 → 連番決定 → ADR作成 → DECISIONS.md追記 → 見直し → コミット）
- 各ステップで使用するツール（Bash, Glob, Read, Write, Edit）を明示

### プロンプトテンプレート
- 変数展開に特化した簡潔なテンプレート（手順・制約は他セクション参照）

### 出力フォーマット
- DECISIONS.md の追記フォーマット（テーブル形式）
- コミットメッセージの例

### リファレンス
- `references/ADR.md`: ADRテンプレート（背景/問い/選択肢/決定/影響/検証の全セクション含む）
- `references/DECISIONS.md`: DECISIONS.mdテンプレート（方針・一覧テーブル・運用ルール含む）

### フォールバック
- テンプレート不在時のフォールバック順序を明確化（プロジェクト内 → 個人保管場所 → 本スキルのreferences → 最小構成で作成）

### 検証
- 5項目のチェックリストで成功条件を明示

## 処理フロー

1. コミット対象の差分（`Bash: git diff --cached`）と方針決定の議論を整理する
2. `{ADR_DIR}` 内の最新ADRを確認し（`Glob` + `Read`）、構成・見出し・語調を合わせる
3. `{DECISIONS_PATH}` を確認し（`Read`）、次の連番 `{NEXT_ID}` を決める
4. 新規ADRを作成（`Write`）: `{ADR_DIR}/{ADR_PREFIX}-{DATE_NOSEP}-{NEXT_ID}.md`
5. `DECISIONS.md` の ADR 一覧に1行追記（`Edit`）
6. 内容を見直し、必要なら修正（`Read` + `Edit`）
7. Git で実装差分 + ADRファイル + DECISIONS.md をまとめてコミット（`Bash: git add && git commit`）

### 入出力仕様

| 項目 | 内容 |
|------|------|
| 入力 | コミット対象の差分、直前の会話履歴（方針決定の議論）、プロジェクト変数（ADR_DIR等） |
| 出力 | 新規ADRファイル（Markdown）、DECISIONS.md への追記行、コミット |

### 使用ツール一覧

- `Bash`: git diff --cached, git add, git commit
- `Glob`: ADRディレクトリ内のファイル検索
- `Read`: 既存ADR・DECISIONS.md の読み取り、内容確認
- `Write`: 新規ADRファイルの作成
- `Edit`: DECISIONS.md への追記、ADR内容の修正

## 構造評価

| 推奨セクション | 状態 | 備考 |
|--------------|------|------|
| Instructions | ✅ 充足 | 「実行フロー」と「作成プロンプト」で手順が明確。各ステップにツール使用を明示 |
| Inputs | ✅ 充足 | 変数テーブルで必須/任意・取得方法を明記 |
| Constraints | ✅ 充足 | 「基本ルール」で制約を明記。フォールバック順序も具体的に定義 |
| Output Format | ✅ 充足 | DECISIONS.md追記フォーマットとコミットメッセージ例を明示 |
| Examples | ✅ 充足 | プロンプトテンプレート + references/ に完成形テンプレート（ADR.md, DECISIONS.md）を配置 |
| Verification | ✅ 充足 | 5項目のチェックリストで成功条件を明示 |

## ルーブリック評価

| 軸 | 優先度 | 評価 | 理由 |
|----|--------|------|------|
| 構造の完全性 | 高 | Good | 6セクションすべてが充足。references/ の追加で Examples も完全に |
| 成功基準の明確性 | 高 | Good | 検証チェックリストで5つの具体的な成功条件を明示 |
| トークン効率 | 高 | Good | プロンプトテンプレートは変数展開のみに簡素化、テンプレートは外部ファイルに分離 |
| 指示の具体性 | 中 | Good | 各ステップが具体的で使用ツールも明示。フォールバック順序も段階的に定義 |
| 使用例の充実 | 中 | Good | フォーマット例 + references/ に完成形テンプレートを配置 |
| 一貫性 | 低 | Good | dotfiles リポジトリ内の他スキルと命名・構造が概ね一致。日本語で統一 |

## チューニング推奨事項

現時点でチューニング推奨事項はありません。全軸が Good 評価です。
